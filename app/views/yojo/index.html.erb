<!-- Home Page-->   
<header class="masthead d-flex" >
  <div class="container text-center my-auto">
    <p class="mb-1 font"> 우리집 셰프는 요조 </p>
    <h1 class="mb-5" id=logo >YO<a id="yojo">RI</a>JO<a id="yojo">RI</a></h1>
    <a class="roundbtn js-scroll-trigger" href="#search">재료 조합하러 가기</a>
  </div>
  <!--<div class="overlay"></div>-->
</header>

<div class="sidenav">
  <a href<% if user_signed_in? %>='/yojo/kitchen'<% else %> onclick="guestWarning()" <% end %>
    data-toggle="tooltip" data-placement="right" title="마이키친 페이지"><img class="icon" src="/assets/fridge.png"><p>마이키친</p></a><br>
  
  <a href<% if user_signed_in? %>='/yojo/yori_book/0'<% else %> onclick="guestWarning()" <% end %>
    data-toggle="tooltip" data-placement="right" title="내 요리 & 스크랩한 레시피"><img class="icon" src="/assets/book.png"><p>요리북</p></a><br>
  <a href<% if user_signed_in? %>='/yojo/new_yori'<% else %> onclick="guestWarning()" <% end %>
    data-toggle="tooltip" data-placement="right" title="나만의 레시피를 올려보아요"><img class="icon" src="/assets/edit.png"><p>레시피 올리기</p></a><br>
</div>

<!-- Search Page-->
<div class="search-wrapper">
  <div class="types">
    <input type="radio" name="search type" onclick="switchSearch(this)" value=1 
    <% if @type == 1 %>
      checked
    <% end %>
    > 재료 조합하기
    <input type="radio" name="search type" onclick="switchSearch(this)" value=2
    <% if @type == 2 %>
      checked
    <% end %>
    > 요리 검색하기
    <input type="radio" name="search type" onclick="switchSearch(this)" value=3
    <% if @type == 3 %>
      checked
    <% end %>
    > 아이디로 검색하기
  </div>
  <br>
  
  <form action="/0" id="search" class="font" >
      <% if @type == 1 %>
          재료:
          <input id="ingredient_search" class="bar" type="text">
          <button class="roundbtn" type="button" onclick="combine()">조합</button>
          
          <div id="ingredient_results"></div>
          
          <script>
            map.clear();
            new app.SearchIngredients;
            
            $("#ingredient_search").keydown(function(event) {
               if (event.keyCode == 13) {
                   event.preventDefault();
               }
            });
          </script>
      <% elsif @type == 2 %>
          요리:
          <input class="bar" type="text" name="yori" autocomplete="off" autofocus>
          <input class="roundbtn" type="submit" value="검색">
      <% else %>
          아이디:
          <input class="bar" type="text" name="id" autocomplete="off" autofocus>
          <input class="bt roundbtn" type="submit" value="검색">
      <% end %>
  </form>
  <div id="filters"></div>
</div>

<div id="results">
    <% if @posts != nil %>
        <% @count = 0 %>
        <% @posts.each do |post| %>
            <% @yori = Yori.find(post.yori_id) %>
            <% if (@count % 4) == 0 %>
              <div class="row" style="width: 98%; margin-top: 1em; margin-left: 1em">
            <% end %>
                <div class="col-lg-3 col-md-4 col-sm-6 portfolio-item">
                  <div class="card h-100">
                    <a href="#"><img class="card-img-top" src="http://placehold.it/700x400" alt=""></a>
                    <div class="card-body">
                      <h4 class="card-title">
                        <a href="/yojo/yori/<%=@yori.id%>"><%=@yori.name%></a>
                        <p>by. <%= User.find(@yori.user_id).username %></p>
                      </h4>
                      <p class="card-text"><%=Post.find_by(yori_id: @yori.id).main%></p>
                    </div>
                  </div>
                </div>
            <% if @count % 4 == 3 %>
              </div>
            <% end %>
            <% @count += 1 %> 
        <% end %>
        <% if @count % 4 != 0 %>
          </div>
        <% end %>
    <% end %>
    
    <% if @yoris != nil %>
      <div class="page-center">
        <ul id="page-list" class="pagination">
          <li class="page-item"><a class="page-link" <% if @current_page > 0 %> href="<%=@current_page - 1%>?
          <% if @type == 2 %>
yori=<%=params[:yori]%>
          <% elsif @type == 3 %>
id=<%=params[:id]%>
          <% end %>
"<%end%>>prev</a></li>
        <% for i in 0...@max_page %>
          <li class="page-item"><a <% if i == @current_page%>id="current-page"<%end%> class="page-link" href="<%=i%>?
          <% if  @type == 2 %>
yori=<%=params[:yori]%>
          <% elsif @type == 3 %>
id=<%=params[:id]%>
          <% end %>
"><%=i + 1%></a></li>
        <% end %>
          <li class="page-item"><a class="page-link" <% if @current_page+1 < @max_page %> href="<%=@current_page + 1%>?
          <% if @type == 2 %>
yori=<%=params[:yori]%>
          <% elsif @type == 3 %>
id=<%=params[:id]%>
          <% end %>
"<%end%>>next</a></li>
        </ul>
      </div>
    <% end %>
</div>

<script>
    function combine() {
        console.log(map);
        var array = [];
        map.forEach(function(value, key) {
            array.push(value);
        });
        
        $.ajax({
            url : "/yojo/combine",
            type : "get",
            data : { data_value: array }
        });
    }
    
    function combinePage(page) {
      console.log(map);
      var array = [];
      map.forEach(function(value, key) {
          array.push(value);
      });
        
      $.ajax({
          url : "/yojo/combine/"+page,
          type : "get",
          data : {
            data_value: array,
            page_number: page
          }
      });
    }
    
    function switchSearch(radio) {
        // can comment if we want to keep our filters
        if (radio.value != 1) {
            $("#filters span").remove();
        }
        
        $.ajax({
            url : "/yojo/switch",
            type : "get",
            data : { data_value: radio.value }
        });
    }
</script>

<script>
  function guestWarning() {
    alert("로그인 후 이용해주세요!")
  }
</script>

<!--Script-->
<script type="text/javascript">
// https://blackrockdigital.github.io/startbootstrap-stylish-portfolio/js/stylish-portfolio.min.js
var scrollOffset = -118;

  ! function(e) {
    "use strict";
    e(".menu-toggle").click(function(a) {
        a.preventDefault(), e("#sidebar-wrapper").toggleClass("active"), e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times"), e(this).toggleClass("active")
    }), e('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {
        if (location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") && location.hostname == this.hostname) {
            var a = e(this.hash);
            if ((a = a.length ? a : e("[name=" + this.hash.slice(1) + "]")).length) return e("html, body").animate({
                scrollTop: a.offset().top + scrollOffset
            }, 1e3, "easeInOutExpo"), !1
        }
    }), e("#sidebar-wrapper .js-scroll-trigger").click(function() {
        e("#sidebar-wrapper").removeClass("active"), e(".menu-toggle").removeClass("active"), e(".menu-toggle > .fa-bars, .menu-toggle > .fa-times").toggleClass("fa-bars fa-times")
    }), e(document).scroll(function() {
        e(this).scrollTop() > 100 ? e(".scroll-to-top").fadeIn() : e(".scroll-to-top").fadeOut()
    })
    }(jQuery);
    var onMapMouseleaveHandler = function(e) {
            var a = $(this);
            a.on("click", onMapClickHandler), a.off("mouseleave", onMapMouseleaveHandler), a.find("iframe").css("pointer-events", "none")
        },
        onMapClickHandler = function(e) {
            var a = $(this);
            a.off("click", onMapClickHandler), a.find("iframe").css("pointer-events", "auto"), a.on("mouseleave", onMapMouseleaveHandler)
        };
    $(".map").on("click", onMapClickHandler);
</script>
